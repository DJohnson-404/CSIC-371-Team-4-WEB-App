<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>BurgB - Restaurant Management</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto",
          "Oxygen", "Ubuntu", "Cantarell", "Fira Sans", "Droid Sans",
          "Helvetica Neue", sans-serif;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
      }

      .App {
        min-height: 100vh;
        padding: 2rem 1rem;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
      }

      .header {
        text-align: center;
        color: white;
        margin-bottom: 2rem;
      }

      .header h1 {
        font-size: 3rem;
        font-weight: 700;
        margin-bottom: 0.5rem;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
      }

      .subtitle {
        font-size: 1.2rem;
        opacity: 0.9;
      }

      .error-banner {
        background: #ff4757;
        color: white;
        padding: 1rem;
        border-radius: 8px;
        margin-bottom: 1.5rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }

      .error-banner.hidden {
        display: none;
      }

      .error-banner button {
        background: transparent;
        border: none;
        color: white;
        font-size: 1.5rem;
        cursor: pointer;
        padding: 0 0.5rem;
      }

      .actions-bar {
        display: flex;
        gap: 1rem;
        margin-bottom: 2rem;
        flex-wrap: wrap;
      }

      .btn {
        padding: 0.75rem 1.5rem;
        border: none;
        border-radius: 8px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .btn-primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
      }

      .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      }

      .btn-secondary {
        background: white;
        color: #667eea;
      }

      .btn-secondary:hover {
        background: #f8f9fa;
        transform: translateY(-2px);
      }

      .btn-block {
        width: 100%;
        margin-top: 1rem;
      }

      .add-form-card {
        background: white;
        padding: 2rem;
        border-radius: 12px;
        margin-bottom: 2rem;
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
      }

      .add-form-card.hidden {
        display: none;
      }

      .add-form-card h2 {
        margin-bottom: 1.5rem;
        color: #333;
        font-size: 1.5rem;
      }

      .form-group {
        margin-bottom: 1.5rem;
      }

      .form-group label {
        display: block;
        margin-bottom: 0.5rem;
        color: #555;
        font-weight: 600;
      }

      .form-group input,
      .form-group select {
        width: 100%;
        padding: 0.75rem;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        font-size: 1rem;
        transition: border-color 0.3s ease;
      }

      .form-group input:focus,
      .form-group select:focus {
        outline: none;
        border-color: #667eea;
      }

      .loading {
        text-align: center;
        padding: 4rem 2rem;
        color: white;
      }

      .loading.hidden {
        display: none;
      }

      .spinner {
        border: 4px solid rgba(255, 255, 255, 0.3);
        border-top: 4px solid white;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        animation: spin 1s linear infinite;
        margin: 0 auto 1rem;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .empty-state {
        text-align: center;
        padding: 4rem 2rem;
        background: white;
        border-radius: 12px;
        color: #666;
        font-size: 1.2rem;
      }

      .empty-state.hidden {
        display: none;
      }

      .items-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 1.5rem;
      }

      .item-card {
        background: white;
        border-radius: 12px;
        padding: 1.5rem;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
        position: relative;
      }

      .item-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
      }

      .item-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 1rem;
        padding-bottom: 1rem;
        border-bottom: 2px solid #f0f0f0;
      }

      .item-header h3 {
        color: #333;
        font-size: 1.5rem;
        font-weight: 700;
        margin: 0;
        flex: 1;
      }

      .delete-btn {
        background: transparent;
        border: none;
        font-size: 1.5rem;
        cursor: pointer;
        padding: 0.25rem 0.5rem;
        border-radius: 6px;
        transition: all 0.2s ease;
        opacity: 0.7;
      }

      .delete-btn:hover {
        opacity: 1;
        background: #ffebee;
        transform: scale(1.1);
      }

      .item-details {
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
      }

      .detail-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .detail-row .label {
        color: #666;
        font-weight: 500;
      }

      .detail-row .value {
        color: #333;
        font-weight: 600;
      }

      .detail-row .value.price {
        color: #667eea;
        font-size: 1.2rem;
      }

      @media (max-width: 768px) {
        .header h1 {
          font-size: 2rem;
        }

        .items-grid {
          grid-template-columns: 1fr;
        }

        .actions-bar {
          flex-direction: column;
        }

        .btn {
          width: 100%;
        }
      }
    </style>
  </head>
  <body>
    <div class="App">
      <div class="container">
        <header class="header">
          <h1>üçî BurgB Restaurant Management</h1>
          <p class="subtitle">Manage your menu items</p>
        </header>

        <div id="errorBanner" class="error-banner hidden">
          <span id="errorMessage"></span>
          <button onclick="hideError()">√ó</button>
        </div>

        <div class="actions-bar">
          <button class="btn btn-primary" onclick="toggleAddForm()">
            <span id="addButtonText">+ Add New Item</span>
          </button>
          <button class="btn btn-secondary" onclick="fetchItems()">
            üîÑ Refresh
          </button>
        </div>

        <div id="addFormCard" class="add-form-card hidden">
          <h2>Add New Item</h2>
          <form id="addItemForm" onsubmit="handleAddItem(event)">
            <div class="form-group">
              <label for="item_name">Item Name</label>
              <input
                type="text"
                id="item_name"
                name="item_name"
                required
                placeholder="e.g., Cheeseburger"
              />
            </div>

            <div class="form-group">
              <label for="unit_id">Unit</label>
              <select id="unit_id" name="unit_id" required>
                <option value="1">each</option>
                <option value="2">lb</option>
              </select>
            </div>

            <div class="form-group">
              <label for="price_per_item">Price per Item</label>
              <input
                type="number"
                id="price_per_item"
                name="price_per_item"
                required
                step="0.01"
                min="0"
                placeholder="0.00"
              />
            </div>

            <button type="submit" class="btn btn-primary btn-block">
              Add Item
            </button>
          </form>
        </div>

        <div id="loading" class="loading">
          <div class="spinner"></div>
          <p>Loading items...</p>
        </div>

        <div id="emptyState" class="empty-state hidden">
          <p>üìã No items found. Add your first item to get started!</p>
        </div>

        <div id="itemsGrid" class="items-grid"></div>
      </div>
    </div>

    <script>
      // Detect if we're being served from Flask or opened directly
      // If served from Flask (same origin), use relative URLs
      // Otherwise, use absolute URL to Flask backend
      const isServedFromFlask =
        window.location.protocol === "http:" ||
        window.location.protocol === "https:";
      const API_BASE_URL = isServedFromFlask
        ? "/api" // Relative URL when served from Flask
        : "http://localhost:5000/api"; // Absolute URL when opened directly

      let items = [];
      let showAddForm = false;

      // Initialize on page load
      document.addEventListener("DOMContentLoaded", () => {
        fetchItems();
      });

      function showError(message) {
        const errorBanner = document.getElementById("errorBanner");
        const errorMessage = document.getElementById("errorMessage");
        errorMessage.textContent = `‚ö†Ô∏è ${message}`;
        errorBanner.classList.remove("hidden");
      }

      function hideError() {
        document.getElementById("errorBanner").classList.add("hidden");
      }

      function toggleAddForm() {
        showAddForm = !showAddForm;
        const formCard = document.getElementById("addFormCard");
        const buttonText = document.getElementById("addButtonText");

        if (showAddForm) {
          formCard.classList.remove("hidden");
          buttonText.textContent = "‚úï Cancel";
        } else {
          formCard.classList.add("hidden");
          buttonText.textContent = "+ Add New Item";
          document.getElementById("addItemForm").reset();
        }
      }

      async function fetchItems() {
        try {
          showLoading(true);
          hideError();

          const response = await fetch(`${API_BASE_URL}/items`);
          if (!response.ok) throw new Error("Failed to fetch items");

          items = await response.json();
          renderItems();
        } catch (err) {
          showError(err.message);
          console.error("Error fetching items:", err);
        } finally {
          showLoading(false);
        }
      }

      function showLoading(show) {
        const loading = document.getElementById("loading");
        if (show) {
          loading.classList.remove("hidden");
        } else {
          loading.classList.add("hidden");
        }
      }

      function renderItems() {
        const itemsGrid = document.getElementById("itemsGrid");
        const emptyState = document.getElementById("emptyState");

        if (items.length === 0) {
          itemsGrid.innerHTML = "";
          emptyState.classList.remove("hidden");
          return;
        }

        emptyState.classList.add("hidden");
        itemsGrid.innerHTML = items
          .map(
            (item) => `
                <div class="item-card">
                    <div class="item-header">
                        <h3>${escapeHtml(item.name)}</h3>
                        <button
                            class="delete-btn"
                            onclick="handleDeleteItem(${item.item_id})"
                            aria-label="Delete item"
                        >
                            üóëÔ∏è
                        </button>
                    </div>
                    <div class="item-details">
                        <div class="detail-row">
                            <span class="label">Price:</span>
                            <span class="value price">${formatPrice(
                              item.price_per_item
                            )}</span>
                        </div>
                        <div class="detail-row">
                            <span class="label">Unit:</span>
                            <span class="value">${escapeHtml(
                              item.unit_name
                            )}</span>
                        </div>
                        <div class="detail-row">
                            <span class="label">ID:</span>
                            <span class="value">#${item.item_id}</span>
                        </div>
                    </div>
                </div>
            `
          )
          .join("");
      }

      async function handleAddItem(event) {
        event.preventDefault();

        const formData = {
          item_name: document.getElementById("item_name").value,
          unit_id: parseInt(document.getElementById("unit_id").value),
          price_per_item: parseFloat(
            document.getElementById("price_per_item").value
          ),
        };

        try {
          const response = await fetch(`${API_BASE_URL}/items`, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(formData),
          });

          if (!response.ok) {
            const errorData = await response.json();
            throw new Error(errorData.error || "Failed to add item");
          }

          // Reset form and refresh items
          document.getElementById("addItemForm").reset();
          toggleAddForm();
          fetchItems();
        } catch (err) {
          showError(err.message);
          alert(`Error: ${err.message}`);
        }
      }

      async function handleDeleteItem(itemId) {
        if (!window.confirm("Are you sure you want to delete this item?")) {
          return;
        }

        try {
          const response = await fetch(`${API_BASE_URL}/items/${itemId}`, {
            method: "DELETE",
          });

          if (!response.ok) throw new Error("Failed to delete item");
          fetchItems();
        } catch (err) {
          showError(err.message);
          alert(`Error: ${err.message}`);
        }
      }

      function formatPrice(price) {
        return `$${parseFloat(price).toFixed(2)}`;
      }

      function escapeHtml(text) {
        const div = document.createElement("div");
        div.textContent = text;
        return div.innerHTML;
      }
    </script>
  </body>
</html>
